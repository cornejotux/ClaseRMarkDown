# Creando funciones de R

Mucha gente escribe los código de R como un flujo simple y continuo de comandos, 
incluso algunas veces sacado directamente de la consola de R y copiado a un 
script con el texto. Si bien cualquier script tiene tremendos beneficios en
por sobre soluciones basadas en el uso del mouse, existen ventajas de usar
códigos en fragmentos pequeños o bien en módulos reusables. Este es el rol
de las funciones (`function`) en R.  En esta clase, vamos a revisar las ventajas
de escribir códigos usando funciones, practicaremos creando algunas funciones
y mostraremos como llamarlas. Finalmente terminaremos con ejercicios donde 
construiremos algunas funciones simples.

## Objetivos

- Aprender por que debemos escribir códigos utilizando funciones pequeñas
- Escribir código para una o más funciones
- Documentar las funciones para explicar su funcionamiento y comunicación del código

## ¿Por qué funciones?

En inglés se usa el acronismo **DRY** que se traduce a _No Se Repita a Si Mismo_
(Don't Repeat Yourself).

Al crear funciones pequeñas y autocontenidas que desarrollan una sola función y 
lo hacen bien, podemos rápidamente ganar:

- Mejoras en el entendimiento del código
- Re-uso del código a través de la descomposición de tareas en fragmentos pequeños
- Mejorar la revisión de errores

## Conversión de temperatura

Imagine que tiene unos datos de temperatura medidos en grados Fahrenheit y los quiere convertir
a Celsius para realizar los análisis. Puede ser que para este fin usted escriba un código de R
que haga precisamente esto.

```{r}
airtemps <- c(212, 30.3, 78, 32)
celsius1 <- (airtemps[1]-32)*5/9
celsius2 <- (airtemps[2]-32)*5/9
celsius3 <- (airtemps[3]-32)*5/9
```

Note que existe 3 lineas de código duplicado, donde se repite la fórmula. Este código se puede 
acortar y hacer más confiable sin las repeticiones.

## Creando una función

Las funciones de R son un mecanismo donde se procesa una entrada y se devuelve un valor de salida.
En forma similar a otras variables, las funciones pueden ser asignadas una una variable, de esta 
forma puede ser utilizada en diferentes partes del código. Para crear una función en R, se usa la 
función `function` y se asigna su resultado a una variable. Creemos de esta forma una función que 
calcule la temperatura en grados celsius cuando se le pasan valores en fahrenheit.

```{r}
fahr_to_celsius <- function(fahr) {
  celsius <- (fahr-32)*5/9
  return(celsius)
}
```

Al ejecutar este código, hemos creado una función y la hemos almacenado en el ambiente global de R.
El argumento `fahr` de la función `function` indica que la función que hemos creado toma un único
parámetro (la temperatura en fahrenheit) y la declaración `return` indica que la función debe
devolver el valor almacenado en la variable `celsius` que fue calculado dentro de la función.
Usemos ahora la función y veamos si obtenemos los mismos valores:

```{r}
celsius4 <- fahr_to_celsius(airtemps[1])
celsius4
celsius1 == celsius4
```

¡Excelente!.  Entonces ahora tenemos una función que convierte los grados que podemos usar. Note que, 
porque la mayoría de las operaciones en R pueden tomar múltiples tipos de entradas, podemos pasarle
el vector original de `airtemps` y calcular todos los resultados al mismo tiempo:

```{r}
celsius <- fahr_to_celsius(airtemps)
celsius
```

De esta forma, toma el vector de temperaturas en fahrenheit y devuelve el vector de temperaturas en grados 
celsius.

## Actividad

Cree una función que transforme los datos de grados celsius a fahrenheit (`celsius_to_fahr`), toma los datos en
en celsius y los devuelve convertidos a fahrenheit. Luego use esta forma para convertir el vector `celsius` a
un vector de temperaturas fahrenheit y compare los resultados al vector original `airtemps` para verificar
que están correctos.

```{r}
# Escriba aquí su código

```

¿Encontró problemas con el redondeo de valores o precisión?

## Documentando funciones de R

Las funciones necesitan ser documentadas para que se pueda comunicar que es lo que hacen y por qué. El 
paquete `roxygen2` provee una forma simple de documentar sus funciones, explicar que es lo que hacen, los
supuestos, descripciones sobre los valores que se devuelves y la racionalidad para las
decisiones que se hicieron para la implementación de la función.

La documentación en ROxygen se incluye inmediatamente antes de la definición de la función. Para esto se 
indica que es parte de la documentación inicial la linea con los caracteres `#'`.  Aquí hay una
versión documentada de una función:

```{r}
#' Convierte los datos de temperatura de Fahrenheit a Celsius
#'
#' @parametros fahr Datos de temperatura en grados Fahrenheit que serán convertidos
#' @return Valores de temperatura en grados Celsius
#' @keywords conversion
#' @export
#' @ejemplos
#' fahr_to_celsius(32)
#' fahr_to_celsius(c(32, 212, 72))
fahr_to_celsius <- function(fahr) {
  celsius <- (fahr-32)*5/9
  return(celsius)
}
```

Note el uso de las palabras claves `@param` para definir los datos de entrada esperados y `@return` para 
definir los valores que serán devueltos por la función. La función de `@examples` es útil como un recordatorio
de como se debe usar la función. Finalmente, la palabra clave `@export` indica que, si esta función fuera 
agregada a un paquete, entonces la función estará disponible para ser usado por otros códigos o 
paquetes.

## Resumen

- Las funciones son útiles para reducir la redundancia, reusar código y reducir los errores
- Construir funciones con la función `function`
- Documentar las funciones con comentarios `roxygen2`
