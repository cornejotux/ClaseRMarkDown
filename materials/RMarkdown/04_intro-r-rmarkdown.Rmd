# Introducción a R

## Objetivos

- Orientarse en la interfase de RStudio
- Trabajar en la consola de R


## Introducción y Motivación

Existe una comunidad muy activa y que en forma colectiva esta desarrollando en forma
cada vez herramientas de programación de código abierto mas fáciles de usar y 
potentes. El progreso actual en relación a las herramientas de programación permiten que 
aprender a escribir códigos computacionales sea cada vez más fácil. Incorporando la 
programación a el procesos de análisis no solo hace que la ciencia sea más eficientes, 
si no que además sea computacionalmente reproducible. En este curso, vamos a usar 
el lenguaje de programa R y para esto usaremos el Ambiente de Programación Integrada
(integrated development environment o IDE) RStudio. R es un lenguaje ideal para aprender
programación orientada al los datos, porque es ampliamente utilizada por la comunidad
científica, es amigable con el usuario (user-friendly) y lo más importante es de código
abierto (open source). 

Entonces, ¿cuales son las diferencias entre _R_ y _RStudio_? Aquí les presento una analogía como punto de partida. **Si usted fuera un chef, _R_ es un cuchillo.** Usted tiene comida para preparar y el cuchillo es una de las herramientas que va a usar para realizar esta tarea.

Y **si _R_ es un cuchillo, entonces _RStudio_ es la cocina**. ¡RStudio le entrega el 
lugar donde puede realizar todo su trabajo! Otras herramientas, comunicaciones, comunidad
y hacer su vida como chef más fácil. Ahora, como científico, RStudio hace su vida mas
fácil, poniendo todas las herramienta que usted necesita en un mismo lugar, de esta 
forma puede trabajar en forma más eficiente. Algunas de las herramientas que puede 
encontrar son un navegador de archivos, visor de datos, páginas de ayuda, terminal, 
comunidad, soporte y la lista suma y sigue. De esta forma, se puede ver que es mucho 
más que solo una infraestructura (la interfase del usuario o IDE). Entonces, si bien
es posible preparar comida sin una cocina, es totalmente posible aprender y trabajar
en R sin usar RStudio, eso no es lo que vamos hacer. Nosotros vamos a aprovechar los 
beneficios de usar RStudio y aprenderemos R y RStudio al mismo tiempo.

```{r rueda, echo=FALSE, out.width = '50%', fig.align = 'center', fig.cap = 'Usar R sin RStudio es como tener una rueda cuadrada. No tiene sentido.'}
knitr::include_graphics("images/4.1_rueda.jpg")
```

Algo para tener en cuenta que es vamos a aprender un nuevo lenguaje (de programación). Este es un proceso, 
toma tiempo, se cometerán errores, puede resultar frustrante, pero a largo plazo va a 
ser genial. Todos hablamos a lo menos un lenguaje; este es un proceso similar, de verdad.
Y no importa cuan fluido seas en tu lengua materna, siempre se aprende algo nuevo, se tratan
cosas en un nuevo contexto, se aprenden sinónimos, o que significa algo diferente en otro país,
etc. Y como cualquier otra forma de comunicación, se producirán malos entendidos que serán
frustrantes, pero a la largo, todos terminamos siendo mejores producto de ellos.

Así como un lenguaje es un concepto familiar, lenguajes de programación existen en un contexto 
diferente de los lenguajes hablados, pero vamos a llegar a conocer este contexto con el tiempo.
Por ejemplo: tenemos un concepto que es la primera comida del día y tenemos un nombre para eso:
en español esa palabra es "desayuno". Si usted aprende inglés, puede esperar que exista una
palabra para expresar este concepto de la primera comida (esa palabra es "breakfast"). **Vamos 
a llegar al punto en que usted va a esperar la existencia de cierta palabras en un el lenguaje 
de programación (llamados funciones en R) que representen conceptos**. Pronto, usted va a 
esperar que exista una forma de ordenar valores en forma numérica o alfabética, para buscar 
patrones en un texto, calcular la media o mediana,  reorganizar columnas en fila, extraer un 
subset de datos, etc. Paso a paso, vamos a ir incrementando sus expectativas y aprenderán como 
preguntar (en RStudio) y encontrar las _palabras_ que están buscando.

### Recursos

Este curso es una traducción libre, modificada y adaptada, desde una combinación de excelentes clases
y materiales desarrollados por otros. Muchas gracias al Data Task Force de [NCEAS](http://www.nceas.ucsb.edu),
en especial a Jeannette Clark, Jared Kibele, Matt Jones y yo) quienes desarrollaron la versión original
de este curso en Inglés. A  Julie Lowndes por escribir la mayoría del contenido del cual se basó el
Data task Force y nos compartió el material para basarnos en su trabajo, el que a su vez está basado
en el material de Jenny Bryan. Todo el material original sobre el cual está basado este curso está en inglés, 
sin embargo les recomiendo darle una mirada y usarlo como referencia:

[Julie Lowndes' Data Science Training for the Ocean Health Index](http://ohi-science.org/data-science-training/)

- [R, RStudio, RMarkdown](http://ohi-science.org/data-science-training/rstudio.html)
- [Programming in R](http://ohi-science.org/data-science-training/programming.html)


[Jenny Bryan's lectures from STAT545 at UBC](https://stat545-ubc.github.io/)

- [R basics, workspace and working directory, RStudio projects](http://stat545-ubc.github.io/block002_hello-r-workspace-wd-project.html)
- [Basic care and feeding of data in R](http://stat545-ubc.github.io/block006_care-feeding-data.html)

RStudio (también en inglés): 

- [webinars](https://www.rstudio.com/resources/webinars/) 
- [cheatsheets](https://www.rstudio.com/resources/cheatsheets/)

Finalmente, el libro _R for Data Science_ por Hadley Wickham es un recurso genial para profundizar en estos temas.

- [R for Data Science](http://r4ds.had.co.nz/)

Otros recursos relacionados:

- [Formate de ecuaciones en LaTeX](https://www.caam.rice.edu/~heinken/latex/symbols.pdf)
- [Base R Cheatsheet](https://www.rstudio.com/wp-content/uploads/2016/05/base-r.pdf)
- [RMarkdown Reference Guide](https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf)
- [MATLAB/R Translation Cheat Sheet](http://mathesaurus.sourceforge.net/octave-r.html)


## R en la consola

Y ahora manos a la obra.

Inicie RStudio/R.


```{r RStudioIDE, echo=FALSE, out.width = '100%', fig.align = 'center', fig.cap = 'Captura de pantalla de la interfase de desarrollo de RStudio.'}
knitr::include_graphics("images/4.2_RStudio_IDE.png")
```

Identifique los paneles que se abren por defecto:

  * Consola (Todo el espacio a la izquierda)
  * Ambiente/Historial (Pestañas al lado superior derecho)
  * Archivos/Gráficos/Paquetes/Ayuda (Pestañas al lado inferior derecho)

NOTA: Es posible cambiar la ubicación por defecto de los paneles, entre otra muchas
cosas: [Configurando RStudio](https://support.rstudio.com/hc/en-us/articles/200549016-Customizing-RStudio)
(En inglés). 

Una primera pregunta importante: **¿Dónde estamos?** 

Si usted acaba de abrir RStudio por primera vez, se va a encontrar en el su directorio 
Home o Mis Documentos en Windows. Esto se denota por como `~/` en la barra superior de 
la consola (destacado en rojo en la figura \@ref(fig:RStudioIDEhomeDir)). Es posible 
ver también el panel de archivos en el lado inferior derecho, donde se muestra que esta 
en el directorio Home. Usted puede navegar con el explorador de archivos, pero note que 
no es posible cambiar donde está: incluso cuando haga clic el otros directorios, 
la consola seguirá estando en el directorio Home: `~/`. 

```{r RStudioIDEhomeDir, echo=FALSE, out.width = '100%', fig.align = 'center', fig.cap = 'Consola de R en la interfase de usuario de RStudio.'}
knitr::include_graphics("images/4.3_RStudio_IDE_homedir.png")
```

OK vamos ahora a la consola, donde vamos interactuar con el proceso interactiva de R.

Vamos a usar R para calcular algunas cosas. Primero hagamos algunos cálculos matemáticos
simples.

```{r}
3*4
```

Usted puede asignar un valor de una operación matemática a una variable u objeto en R. 
Para esto se utiliza el operador de asignación `<-`.

Haga una asignación y luego inspección el objeto que acaba de crear.

```{r}
x <- 3 * 4
x
```

Esas operaciones yo las lego como "asocie el valor 12 a **x**".

Todas las declaraciones en R donde usted crea objetos -- "asignaciones" -- tiene esta
forma: `nombreObjeto <- valor`.  

Voy a escribir ahora en la consola con el símbolo gato o hash `#`, que es la forma en 
que R reconoce un texto como comentario y no lo evalúa.

```{r eval = FALSE}
## nombreBbjecto <- valor

## Esta es la forma en que se escriben textos en el código para explicar que es lo que 
## se está haciendo.
```

Los nombres de objetos en R no pueden comenzar con número o contener algunos caracteres 
como son la coma "," o espacios en blanco. Es útil adoptar la [estándares de nomenclatura]
(http://programacion.jias.es/2017/09/estandares-de-nomenclatura-snake-case-kebab-case-camel-case/)
en los nombres de variables.

```{r}
# yo_uso_snake_case
# otra.gente.usa.puntos
# yOtrosUsanCamelCase
```

Haciendo una asignación

```{r}
este_es_un_nombre_muy_largo <- 2.5
```

Para inspeccionar esta variable, en vez que escribirla completa, podemos apretar
la flecha hacia arriba y llamar a nuestro historial de comandos, con los comandos
más recientes primero. Ahora intente de hacer eso y luego borre la asignación (`<- 2.5`): 

```{r}
este_es_un_nombre_muy_largo
```

Otra forma de inspeccionar esta variable es escribiendo el inicio `este_`... y luego
presionando la techa _Tab_, de esta forma RStudio le va a ofrecer opciones, entre las que
puede seleccionar apretando return.

Y una más
```{r}
la_ciencia_es_genial <- "Si lo es!!!"
```

De esta forma, usted puede que que es posible hacer asignaciones de palabras
y no solo número. En R, un objetivo compuesto por palabras se conoce como 
"string" y R reconoce que esto es una palabra y no a número porque están en 
comillas `" "`. Usted puede trabajar R con datos con strings en una forma muy
simple gracias a los paquete [`stringr`](http://stringr.tidyverse.org/) y  [`tidytext`](https://github.com/juliasilge/tidytext#tidytext-text-mining-using-dplyr-ggplot2-and-other-tidy-tools).
No vamos a hablar mucho de string, pero por ahora recuerde que R puede
manejar texto y que puede trabajar con texto y con números en forma combinada.

El hablar de strings y números nos lleva a abordar un concepto muy importante en programación: 
las diferentes _clases_  o _tipos de objetos_. Un objeto es una variable, una función, 
una estructura de datos, un método que haya escrito en un ambiente de desarrollo.
Usted puede ver que objetivos están cargados mirando el panel del ambiente (Environment)
en RStudio. Las operaciones que se pueden hacer con un objeto van a depender del tipo
de objeto que es. ¡¡Esto tiene mucho sentido!! Por ejemplo, no es posible hacer operaciones
matemáticas con un objeto de caracteres (string).

Trate de ejecutar lo siguiente en la linea de comandos de su consola:

```{r, eval = F}
"Hola mundo!" * 3
```

¿Qué pasó? ¿Por qué?

Usted debería haber notado que cuando se asigna un valor a un objeto,
R no imprime el valor por pantalla. Se puede forzar a R a imprimir por 
pantalla poniendo un paréntesis en la asignación del valor o escribiendo
el nombre del objeto:

```{r, purl=FALSE}
peso_kg <- 55    # doesn't print anything
(peso_kg <- 55)  # but putting parenthesis around the call prints the value of `peso_kg`
peso_kg          # and so does typing the name of the object
```

Ahora que R tiene `peso_kg` en la memoria, podemos utilizar la variable para 
hacer operaciones aritméticas. Por ejemplo, podemos querer convertir este peso
a libras (pero en libras es 2.2 veces el peso en kilogramos):

```{r}
2.2 * peso_kg
```

También es posible cambiar el valor de la variable asignando una nuevo:

```{r}
peso_kg <- 57.5
2.2 * peso_kg
```

Esto significa que al asignar el valor a una variable, esto no cambia el valor de 
otras variables. Por ejemplo, asignemos el valor del peso del animal en libras a una
nueva variable, `peso_lb`:

```{r}
peso_lb <- 2.2 * peso_kg
```

y ahora cambiemos `peso_kg` a 100.

```{r}
peso_kg <- 100
```

¿Cuál cree que es el valor ahora del objeto `peso_lb`? ¿126.5 o 220? ¿Por qué?

Usted puede también almacenar más de un valor en un único objeto. Almacenar
una series de pesos en un solo objeto es una forma muy conveniente de desarrollar
un misma operación en múltiples valores al mismo tiempo. Una forma de crear 
un objeto como este es con la función `c()`, la que se refiere a la acción de 
_combinar_ o _concatenar_.

Aquí vamos a crear un _vector_ de pesos en kilogramos y vamos a convertirlos 
todos a libras, asignando el peso en libras a un nuevo objeto.

```{r}
peso_kg <- c(55, 25, 12)
peso_kg
```

```{r}
peso_lb <- peso_kg * 2.2
peso_lb
```


### Los mensajes de error son sus amigos

Contrato implícito con el lenguaje de computador/codificación: Un computador hará todas 
las computaciones tediosas por usted. Usted tiene que ser completamente explícito 
y preciso son sus instrucciones. Errores ortográficos importan. Mayúsculas importan.
¡Tiene que poner atención a como escribe!

Recuerde que este es un lenguaje, no demasiado distinto al español!. Hay tiempos en los
que la gente no entiende lo que usted dice -- Eso pasa y va a pasar nuevamente y hay 
diferentes formas en que esto puede pasar. Algunas  veces se obtendrá un error. Esto 
es similar a cuando alguien le dice ¿Qué? o ¿Puede repetir por favor? No logro entenderlo.
Los mensajes de error son muy útiles en este sentido, porque le indican cuales son las 
partes específicas en las que no le lograron entender. Este es el mejor tipo de errores
que se pueden obtener. Los mensajes de error son su amigo. Búsquelos en Google (Copiar y 
Pegar!) para descubrir que es lo que significan y como los puede corregir.

```{r googleError, echo=FALSE, out.width = '50%', fig.align = 'center', fig.cap = '.'}
knitr::include_graphics("images/4.4_practicalDev_googleErrorMessage.jpg")
```

Pero también hay que tener en cuenta que hay errores que pueden aparecen en forma 
mucho mas sutil, sin un mensaje de error que lo indique. Esto sucede cuando se le da información
que el computados entiende, pero que no es exactamente lo que se quiso decir. 
Es como si yo contara un historia sobre tablas y usted se imagina una con la que va a construir
una repisa, sin embargo yo estoy hablando de tablas de datos. Esto puede llevarme a pensar que
logré transmitir la información que me interesaba a mi audiencia (o a R) sin embargo, lo que dije
fue interpretado en una forma completamente distinta a lo que estaba tratando de decir. 
Y en la medida que yo sigo hablando se genera más y mas confusión... Entonces, es muy importante
que se escriban los código de una forma lo mas limpia y clara, verificando que el código hace
lo que quiere que haga, de esta forma es posible minimizar las confusiones y malos entendidos.

### Operadores y expresiones lógicas

Vamos a tomarnos un momento para hablar sobre **operadores y expresiones lógicas** ya que nos 
permiten hacer preguntas sobre objetos que hemos creado.

- `==` significa 'es igual a'
- `!=` significa 'no es igual a'
- `<` significa 'es menor a'
- `>` significa 'es mayor a'
- `<=` significa 'es menor o igual a'
- `>=` significa 'es mayor o igual a'

```{r}
peso_kg == 2
peso_kg >= 30
peso_kg != 5
```

> Atajos
En su vida como programador de R se van a realizar muchas asignaciones y el operador `<-`
es un dolor de cabeza para escribir. Sin embargo no sea flojo y se acostumbre a usar `=`, 
aunque esto funciona, porque solo le va a generar confusión más tarde. Es mucho mejor 
utilizar los atajos con combinaciones de teclas para este fin, **en RStudio se obtiene
combinando Alt + - (signo menos)**. Note que en RStudio los espacios alrededor de `<-`
aparecen en forma automágica!, lo que demuestra una práctica para formatear el código
muy útil. Los códigos (especialmente los ajenos) son miserables de leer en un buen día.
Dele un descanso a sus ojos y SIEMPRE use los espacios. RStudio tiene muchos [atajos de teclado shortcuts](https://support.rstudio.com/hc/en-us/articles/200711853-Keyboard-Shortcuts) 
muy útiles. Uno importante de mencionar es Alt+Shift+K que muestra la tabla de referencias
de las combinaciones de teclado.


### Limpiando el ambiente de trabajo
Ahora vamos a mirar los objetos que están en nuestro ambiente de trabajo (workspace)
-- en el costado superior derecho. El ambiente de trabajo es donde se acumulan los objetos definidos
por el usuario.

```{r RStudioIDEenv, echo=FALSE, out.width = '100%', fig.align = 'center', fig.cap = 'Captura de pantalla de la interfase de desarrollo de RStudio con comando ejecutados.'}
knitr::include_graphics("images/4.5_RStudio_IDE_env.png")
```

También se puede obtener una lista de los objetos creado usando los siguiente comandos en R:

```{r}
objects()
ls()
```

Si quiere eliminar el objeto llamado `peso_kg` puede hacer lo siguiente:

```{r}
rm(peso_kg)
```

Para eliminar todo:

```{r}
rm(list = ls())
```

o hacer clic en el icono de la la escoba en el panel _Environment_ en RStudio.
