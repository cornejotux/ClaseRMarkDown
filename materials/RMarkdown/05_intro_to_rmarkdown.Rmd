# RMarkdown

## Objetivos

- Explorar RMarkdown
- Introducción a las funciones básicas incluidas en RStudio
- Aprender como usar las páginas de ayuda

## Introducción
Ahora que conocer un poco de la sintaxis básica de R, podemos comenzar a aprender sobre
RMarkdown. La experiencia nos dice que te vas a volver loco y aun así a fallar en generar
un flujo de trabajo reproducible, si tratas de desarrollar código directamente en la 
consola de R. RMarkdown es realmente clave para la investifación colaborativa, es por 
esto que vamos a comenzar con esto rápidamente y lo usaremore durante el resto de este 
curso.

Un archivo de RMarkdown no va a ayudar a tejer un texto _markdown_ con fragmentos de 
código de R que es evaluado y cuyas salidas, como tables y gráficos, son incluidas en el 
documento.

Para abrir un nuevo documento de RMarkdown siga los siguiente pasos:

File -> New File -> RMarkdown... -> Document of output format HTML, OK.


```{r RStudioNew, echo=FALSE, out.width = '75%', fig.align = 'center', fig.cap = 'Captura de pantalla de la interfase para la creación de un proyecto nuevo de RStudio.'}
knitr::include_graphics("images/5.1_rstudio_new-rmd-doc-html.png")
```

Le puede dar un título como "Mi Projecto". Luego clic en OK. 

OK, primero que todo: Al abrir el archivo, vamos a ver un 4° panel de la consola de RStudio, 
este panel es un editor de texto. Este panel editor nos permite abrir varios archivos en 
un único panel.

Ahora démoles una mira a este archivo - a primera vista se puede ver que no está en blanco;
hay un texto inicial que se entrega por defecto. Hay algunas cosas que identificar en el texto: 

- Está en inglés (no se preocupe, lo vamos a reescribir!)
- Hay secciones en blanco y otras en negro. El código R está en las secciones plomas, mientras
que el texto está con fondo blando (por defecto, este color del fondo se puede cambiar). 

```{r rmarkdown, echo=FALSE, out.width = '100%', fig.align = 'center', fig.cap = 'Imagen con el código fuente de un archivo RMarkdown.'}
knitr::include_graphics("images/5.2_rmarkdown.png")
```

<br>

Lo primero que vamos a hacer es hacer generar el código HTML (Knit HTML) haciendo clic 
en la pelota de lana azul en la parte superior del panel con el archivo RMarkdown. 
Cuando haga clic por primera vez en este botón, RStudio pedirá que guarde este archivo. 
Cree un nuevo directorio en algún lugar que le sea facil encontrarlo posteriormente
(por jemeplo Escritorio o Mis Documentos) y dele un nombre que tenga sentido y le permita
recordarlo despues (ej: `clase_rmarkdown`).

<br>

```{r rmarkdownSideSide, echo=FALSE, out.width = '100%', fig.align = 'center', fig.cap = 'Imagen con el código fuente y pagina resultante de un archivo RMarkdown.'}
knitr::include_graphics("images/5.3_rmarkdown_side_by_side.png")
```


¿Que cosas puede notar entre al comparar los dos archivos? 

Las **secciones de código R** plomas están rodeadas de 3 ticks y `{r LABEL}`.
Estas secciones son evaluadas, generando una salida de texto en el caso de 
`summary(cars)` y de un gráfico en el caso de `plot(pressure)`.

Note como el código `plot(pressure)` no se muestra en la salida HTML porque 
la sección de código R tiene la opción `echo=FALSE`.

Algunos otros detalles...

Este archivo de RMarkdown tiene 2 lenguales incluidos: **R** y **Markdown**. 

Aun no sabemos mucho de R, pero ya puede ver que estamos tomando el 
resument de los datos llamados 'cars' y luego los graficamos. Hay mucho más
para aprender sobre R y vamos a trabajar eso en las próximas clases.

El segundo lenguaje que incluyo el archivo es Markdown. Estes es un lenguage
que para dar formato a texto plano y solo hay aproximadamete 15 reglas para 
conocer.

Vea la siguiente sintaxis:

- **Títulos** son procesador en nuvemes múltiples con: `#`, `##`
- **Negrita**: `**palabra**`

Hay muchas tablas [cheatsheets](https://github.com/adam-p/markdown-here/wiki/Markdown-Here-Cheatsheet)
que te puede ayudar a comenzar y una de esas está incluida en RStudio: para abrirla vaya a Help > Markdown Quick Reference
<br />
<br />

**Importante**: El símbolo de gato, número o para los milenial hashtag `#` tiene un 
significado diferente si es usado en Markdown o en R: 

- en R, un gato indica que es un comentario y no será evaluado. Se pueden usar tantos como 
se quiera: `#` es equivalente a `######`. Es sólo una cuestión de estilos.
- en Markdown, un gato indica el nivel del título. Y cuantos use tienen un efecto:
`#` es un "título nivel 1", lo que significa que es la fuente de mayor tamaño y que
está al tope de la gerarquía. `###` es un título nivel 3 y se muestra anidado bajo el 
título `#` y `##`.

Más osbre esto en: http://rmarkdown.rstudio.com/

### Actividad

1. En Markdown, escriba un texto en cursiva (Itálica) y haga una lista numerada. Luego 
agrege algunos subtítulo. Use la Referencia de Uso Rápido de Markdown (en barra del menú: 
Help > Markdown Quick Reference). 
1. Haga clic en Knit para crear su archivo html. 


### Secciones de código

OK. Ahora practiquemos con algunos comandos de R.

Cree una nueva sección en en su RMarkdown siguiendo alguno de estos pasos:

- clic "Insert > R" en la parte superior del panel de edición.
- Escriba a mano 
   \```{r}
   \```
- si no ha borrado una sección de las que venían con el archivo creado por defecto, 
edite esa

Ahora escribamos un poco de código de R. 

```
x <- 4*3
x
```

Ahora al apretar la tecla return el comando no se ejecuta; recuerde que esto
es solo un archivo de texto. Para ejecutarlo, tenemos que ejecutar lo que escribimos
dentro de la seccón de R (el código R en plomo) en la consola. ¿Cómo se hace eso?
Hay vairas formas de hacerlo:

1. Copiar y pegar los comando en la consola.
1. Seleccionar la linea (o poner el curso en ella) y hacer clic en 'Run'. Esto está 
diponible desde:
    a. la barra arriba del archivo (flecha verde)
    b. la barra menú: Code > Run Selected Line(s)
    c. combinación de teclas: control-return en Windows o command-return en macOS.
1. Clic en la flecha verde en el lado superior derecho de su seccion de código.

### Actividad

Agrege algunos otros comandos a su archivo. Ejecutelos de las tres formas indicadas
más arriba. Finalmente, guarde su archivo RMarkdown. 


## Funciones de R

Hasta ahora hemos aprendido alguna sintaxis básica y conceptos de programación en 
R, como navegar en RStudio y RMarkdown, pero no hemos hecho nada complicado o 
interesantes. Aquó es donde las _funciones_ son útiles.

Una función es una forma de agrupar una serie de comandos para desarrollar una
tarea en una forma reusable. Cuando una función es ejecutada, se produce un valor
de salida. Nosotros generalmente deciros que "llamamos" a una función cuando
la ejecutamos. Lo interesante sobre las funciones es que pueden ser creadas por 
los usuarios y guardadas como un objeto usando el operador de asignación ('<-'),
de esta forma es posible escribir una función para lo que sea que se necesite. 
Tenga en cuenta que R tiene una collección gigantesca de funciones pre-existentes.
Para comenzar, vamos a usar algunas funciones de incluidas en R.

Todas las funcioens se llaman usando la misma sintaxis: nombre de la función 
seguido de un paréntesis donde se entregan lo que necesita la función para hacer
lo que fue creada para hacer. Las piezas de informacion que la función necesita 
para hacer su trabajo se conocen como argumentos. De esta forma, la sintaxis 
para usar una función se ve así: 
`valor_resultante <- nombre_de_función(argumento1 = valor1, argumento2 = valor2, ...)`. 

### A simple example

To take a very simple example, let's look at the `mean()` function. As you might expect, this is a function that will take the mean of a set of numbers. Very convenient!

Let's create our vector of weights again:

```{r}
peso_kg <- c(55, 25, 12)
```

and use the `mean` function to calculate the mean weight.

```{r}
mean(peso_kg)
```
## Páginas de ayuda
### Getting help

What if you know the name of the function that you want to use, but don't know exactly how to use it? Thankfully RStudio provides an easy way to access the help documentation for functions.

To access the help page for `mean`, enter the following into your console:

```{r, eval = F}
?mean
```

The help pane will show up in the lower right hand corner of your RStudio.

The help page is broken down into sections:

 - Description: An extended description of what the function does.
 - Usage: The arguments of the function(s) and their default values.
 - Arguments: An explanation of the data each argument is expecting.
 - Details: Any important details to be aware of.
 - Value: The data the function returns.
 - See Also: Any related functions you might find useful.
 - Examples: Some examples for how to use the function.


### Your turn

> Exercise: Talk to your neighbor(s) and look up the help file for a function that you know or expect to exist. Here are some ideas: `?getwd()`, `?plot()`,  `min()`, `max()`, `?log()`).

And there's also help for when you only sort of remember the function name: double-questionmark:
```{r, eval=F}
??install 
```

Not all functions have (or require) arguments:
```{r}
date()
```

### Use a function to read a file into R

So far we have learned how to assign values to objects in R, and what a function is, but we haven't quite put it all together yet with real data yet. To do this, we will introduce the function `read.csv`, which will be in the first lines of many of your future scripts. It does exactly what it says, it reads in a csv file to R.

Since this is our irst time using this function, first access the help page for `read.csv`. This has a lot of information in it, as this function has a lot of arguments, and the first one is especially important - we have to tell it what file to look for. Let's get a file!

#### Download a file from the Arctic Data Center

Navigate to this dataset by Craig Tweedie that is published on the Arctic Data Center. [Craig Tweedie. 2009. North Pole Environmental Observatory Bottle Chemistry. Arctic Data Center. doi:10.18739/A25T3FZ8X.](http://doi.org/10.18739/A25T3FZ8X), and download the first csv file called "BGchem2008data.csv"

Move this file from your Downloads folder into a place you can more easily find it. I recommend creating a folder called `data` in your previously-created directory `arctic_training_files`, and putting the file there.

Now we have to tell `read.csv` how to find the file. We do this using the `file` argument which you can see in usage section in the help page. In RMarkdown, you can either use absolute paths (which will start with your home directory `~/`) or paths **relative to the location of the RMarkdown.** RStudio and RMarkdown have some great autocomplete capabilities when using relative paths, so we will go that route. Assuming you have moved your file to a folder within `arctic_training_files` called `data`, your `read.csv` call will look like this:

```{r, eval = F}
bg_chem <- read.csv("data/BGchem2008data.csv")
```

You should now have an object of the class `data.frame` in your environment called `bg_chem`. Check your environment pane to ensure this is true.

Note that in the help page there are a whole bunch of arguments that we didn't use in the call above. Some of the arguments in function calls are optional, and some are required. Optional arguments will be shown in the usage section with a `name = value` pair, with the default value shown. If you do not specify a `name = value` pair for that argument in your function call, the function will assume the default value (example: `header = TRUE` for `read.csv`). Required arguments will only show the name of the argument, without a value. Note that the only required argument for `read.csv` is `file`.

You can always specify arguments in `name = value` form. But if you do not, R attempts to resolve by position. So above, it is assumed that we want `file = "data/BGchem2008data.csv"`, since file is the first argument. If we wanted to add another argument, say `stringsAsFactors`, we need to specify it explicitly using the `name = value` pair, since the second argument is `header`. For functions I call often, I use this resolve by position for the first argument or maybe the first two. After that, I always use `name = value`.

Many R users (including myself) will override the default `stringsAsFactors` argument using the following call:

```{r}
bg_chem <- read.csv("data/BGchem2008data.csv", stringsAsFactors = FALSE)
```



## Using `data.frames`

A `data.frame` is a two dimensional data structure in R that mimics spreadsheet behavior. It is a collection of rows and columns of data, where each column has a name and represents a variable, and each row represents a measurement of that variable. When we ran `read.csv`, the object `bg_chem` that we created is a `data.frame`. There are a a bunch of ways R and RStudio help you explore data frames. Here are a few, give them each a try:

- click on the word `bg_chem` in the environment pane
- click on the arrow next to `bg_chem` in the environment pane
- execute `head(bg_chem)` in the console
- execute `View(bg_chem)` in the console

Usually we will want to run functions on individual columns in a `data.frame`. To call a specific column, we use the list subset operator `$`. Say you want to look at the first few rows of the `Date` column only. This would do the trick:

```{r}
head(bg_chem$Date)
```

How about calculating the mean temperature of all the CTD samples?

```{r}
mean(bg_chem$CTD_Temperature)
```

Or, if we want to save this to a variable to use later:

```{r}
mean_temp <- mean(bg_chem$CTD_Temperature)
```

You can also create basic plots using the list subset operator.

```{r}
plot(bg_chem$CTD_Depth, bg_chem$CTD_Temperature)
```

There are many more advancted tools and functions in R that will enable you to make better plots using cleaner syntax, we will cover some of these later in the course. 

### Your Turn

> Exercise: Spend a few minutes exploring this dataset. Try out different functions on columns using the list subset operator and experiment with different plots. 

## Troubleshooting

### My RMarkdown won't knit to PDF

If you get an error when trying to knit to PDF that says your computer doesn't have a LaTeX installation, one of two things is likely happening:

1. Your computer doesn't have LaTeX installed
2. You have an installation of LaTeX but RStudio cannot find it (it is not on the path)

If you already use LaTeX (like to write papers), you fall in the second category. Solving this requires directing RStudio to your installation - and isn't covered here.

If you fall in the first category - you are sure you don't have LaTeX installed - can use the R package `tinytex` to easily get an installation recognized by RStudio, as long as you have administrative rights to your computer.

To install `tinytex` run:

```{r, eval = F}
install.packages("tinytex")
tinytex::install_tinytex()
```

If you get an error that looks like `destination /usr/local/bin not writable`, you need to give yourself permission to write to this directory (again, only possible if you have administrative rights). To do this, run this command in the terminal:


    sudo chown -R `whoami`:admin /usr/local/bin

and then try the above install instructions again. More information about `tinytex` can be found [here](https://yihui.name/tinytex/)

### I just entered a command and nothing is happening

It may be because you didn't complete a command: is there a little `+` in your console? R is saying that it is waiting for you to finish. In the example below, I need to close that parenthesis.

```{r, eval=FALSE}
> x <- seq(1, 10
+ 
```

You can either just type the closing parentheses here and push return, or push the `esc` button twice.

### R says my object is not found

New users will frequently see errors that look like this: `Error in mean(myobject) : object 'myobject' not found`

This means that you do not have an object called `myobject` saved in your environment. The common reasons for this are:

- **typeo**: make sure your object name is spelled exactly like what shows up in the console. Remember R is case sensitive.
- **not writing to a variable**: note that the object is only saved in the environment if you use the assignment operator, eg: `myobject <- read.csv(...)`
- **not executing the line in your RMarkdown**: remember that writing a line of code in RMarkdown is not the same as writing in the console, you have to execute the line of code using command + enter, running the chunk, or one of the other ways outlined in the RMarkdown section of this training

## Literate Analysis

RMarkdown is an excellent way to generate literate analysis, and a reproducible workflow. [Here](https://nceas.github.io/sasap-training/materials/reproducible_research_in_r_fairbanks/example-brood-table-analysis.html) is an example of a real analysis workflow written using RMarkdown.

