--- 
title: "Introducción a las aplicaciones web interactivas"
date: "Por definir, 2019"
site: bookdown::bookdown_site
output: bookdown::gitbook
documentclass: book
bibliography: [book.bib]
biblio-style: apalike
link-citations: yes
description: ""
always_allow_html: yes
---

_**Reconocimiento**_: Esta libro esta desarrollado utilizando blogdown y bookdown. Sigue el estilo del 
trabajo realizado para los talleres del [SASAP](https://alaskasalmonandpeople.org/){target="_blank"}  y [Arctic Data Center](https://arcticdata.io/){target="_blank"}  de [NCEAS](https://www.nceas.ucsb.edu/){target="_blank"} . Aquí traduzco, compilo e integro 
materiales de múltiples fuentes, principalmente la página [https://shiny.rstudio.com/](https://shiny.rstudio.com/){target="_blank"} .


# Introducción

En la página principal del paquete `Shiny` se puede leer "*Interactúa.* *Analiza.* *Comunica.* Toma una aproximación
fresca e interactiva para contar tu historia de datos con Shiny. Deja a los usuarios interactuar con tus datos y
análisis. Y hazlo todo con R".

  ![shinyMain](imagenes/main_Shiny.jpg)

El principal atractivo del paquete `Shiny` que es hace muy fácil construir aplicaciones web interactivas, utilizando
código R en forma simple y directa. Estas aplicaciones se pueden hospedar en servidores web en forma independiente
o bien como parte de documentos generados con RMarkdown (esa es otra clase en la que estoy trabajando).

Algunos ejemplos que yo he desarrollado son:

1. Períodos de retorno de salmones de Alaska [Aquí](https://cornejo.shinyapps.io/ggjoy_Escapement/){target="_blank"} 
1. Distribución de frecuencias de talla y edad de salmones de Alaska [Aquí](https://cornejo.shinyapps.io/shiny_asl-AgeLength/){target="_blank"} 
1. Capturas artesanales en Chile (Aun en desarrollo) [Aquí](https://cornejo.shinyapps.io/CapturasArtesanales/){target="_blank"} 

Existen muchas posibilidades y la [galeria](https://shiny.rstudio.com/gallery/see-more.html){target="_blank"}  en la página de Shiny es la mejor fuente de inspiración posible.

En resumen, Shiny combina el poder computacional y simpleza de R con las capacidades interactivas de las páginas web modernas.


## Objetivos

En esta sección Ud. aprenderá:

- Que es Shiny
- Que cosas se pueden hacer con Shiny
- Instalar Shiny en su computador
- Crear su primera aplicación Shiny
- Compartir su aplicación en la red


## Bienvenido a Shiny

Como ya se dijo, Shiny es un paquete de R que hacer muy fácil la implementación de aplicaciones web interactivas
(apps) utilizando el lenguaje al que estamos acostumbrados en R. En esta sección vamos a comenzar a mostrar en que consisten estas aplicaciones, construiremos una y la pondremos en la red para que otras personas puedan verla y jugar con ella.

Si por alguna razón aun no instalar el paquete **Shiny**, abra RStudio, conéctese a Internet y corra el código

```
install.packages("shiny")
```

Ejemplo de una aplicación básica.

 [Shiny Hello World](imagenes/01_hello.png)

El paquete Shiny contiene 11 ejemplos pre-construidos que demuestran como trabaja Shiny y son auto-contenidos.

El ejemplo "Hello Shiny" gráfica un histograma con el los datos de **R** del 
[Viejo Fiel](https://es.wikipedia.org/wiki/Old_Faithful) e incluye una barra deslizable para definir el número de  
intervalos del histograma, de esta forma, al interaccionar con la aplicación, el usuarios puede aumentar o disminuir
el número de intervalos, moviendo con el puntero del mouse, la barra deslizable que se encuentra a la izquierda del
gráfico y al aplicación responderá en forma inmediata a esta acción. 

Vamos a usar una aplicación muy similar a esta para explorar la estructura de un Shiny cuando creemos nuestra primera app.

Para ejecutar en su computador la app **Hello Shiny**, escriba:

```
library(shiny)
runExample("01_hello")
```


## Primera aplicación

Una aplicación `Shiny` básica puede estar contenida en un solo archivo llamado *app.R* en un *directorio*, que se deja un un directorio y esta puede ser ejecutada con **runApp("NombreDirectorio")**.

El código dentro de *app.R* contiene tres secciones:

1. El *objetivo* Interfase de Usuario (UI): Este objeto contiene los controles sobre el diseño y apariencia de la aplicacióin. 
1. La función *Servidor*: Contiene las insutrcciones que el computador necesita ejecutar para consturir la aplicación.
1. La llamada a la funcion *shinyApp*: Esta funcion crea los objetos *Shiny apps* desde el par UI/server.

Para aplicaciones mas complejas y extensas, es recomentable create archivos separados llamados `ui.R` y `serverR`. Además es posible incluir un archivo `global.R` donde se pueden incluir funciones creadas para la aplicación, manipular datos, etc.

Una aspecto muy interesante de programar una aplicacion en un archivo único, es la facilidad de este para ser compartido y ejecutado desde la consola R o lines de comando.

### UI

Aquí esta el objeto `ui` del ejemplo **Hello Shiny**:

```
library(shiny)

# Define UI for app that draws a histogram ----
ui <- fluidPage(
  # App title ----
  titlePanel("Hello Shiny!"),

  # Sidebar layout with input and output definitions ----
  sidebarLayout(
    # Sidebar panel for inputs ----
    sidebarPanel(
      # Input: Slider for the number of bins ----
      sliderInput(inputId = "bins",
                  label = "Number of bins:",
                  min = 1,
                  max = 50,
                  value = 30)
    ),

    # Main panel for displaying outputs ----
    mainPanel(
      # Output: Histogram ----
      plotOutput(outputId = "distPlot")
    )
  )
)
```
De este código es posible identificar los componentes:

1. **titlePanel** donde se define el título de la aplicación.
1. **sidebarLayout** donde se defines los espacios que se utilizan para las intradas de usuario y las salidas, en este caso gráficas.
1.1. **sidebarPanel**, esta esta definido como un subcomponente de **sideberLayout** y define la seccion donde el usuario puede interactuar con la aplición.
1.1.1. **sliderInput** es una barra con la que se pueden definir el número de "bins" que usa el gráfico (que se crea en la seccion **server** de la aplicación).
1.1. **mainPanel** es es espacio donde se desplegaran los resultados, gráficos, tablas, etc.
1.1.1 **plotOoutput** es una subseccion de **mainPanel** done estamos definiendo que la salida es un gráfico.


### Server 

Aquí esta la función `server` del ejemplo **Hello Shiny** y es donde se define la lógica que se usar para generar, en esta caso, un histograma, considerando la entrada de número de barras, definida por la barra con la interactúa el usuario.

```
server <- function(input, output) {

  # Histogram of the Old Faithful Geyser Data ----
  # with requested number of bins
  # This expression that generates a histogram is wrapped in a call
  # to renderPlot to indicate that:
  #
  # 1. It is "reactive" and therefore should be automatically
  #    re-executed when inputs (input$bins) change
  # 2. Its output type is a plot
  output$distPlot <- renderPlot({

    x    <- faithful$waiting
    bins <- seq(min(x), max(x), length.out = input$bins + 1)

    hist(x, breaks = bins, col = "#75AADB", border = "white",
         xlab = "Waiting time to next eruption (in mins)",
         main = "Histogram of waiting times")

    })
}

```

Al crear esta función se definen dos variables de entrada, *inputs* y *outputs*. Estos son las variables con las que la funcion **server** interactúa con el resto de la aplicación.

En este ejemplo podemos identificar que tenemos en **output** almacenamos un gráfico en el objeto *disPlot* (que si ven en *ui* es lo que se despliega como resultado). Este gráfico fue construido definiendo:
inputIds.

1. **bins**: Es el número de barras a desplegar y define su número con *length.out* que toma la entrada de **input$bins**, que es definida en UI, en la seccion *sidebarLayout*, donde la funcion sliderInput, tiene como primer argumento inputId = "bins", que el nombre al que se le da, para ser utilizado como una variable que puede ser pasada en otras secciones de la shiny app como **input$bins**.
1. **hist**: Aquí se genera el histograma, utilizando el número **bins** como un varible que se le entrega al argumento *breaks* de la función hist, que hace el histograma.

En resumen, la funcion **server** es muy simple, el códifo hace unos calculos (i.e. bins) y luego hace un histgrama con el número predefinido de barras y lo devuelve como un output llamado disPlot, que luego es desplegado en la seccion mainPanel de la Interfase de Usuario (UI). 



Ahora que tiene un mejor entendimiendo de como funciona, manipule algunos argumentos y vea los resultados, trate de obtenener una mejor idea de como funciona y que pasa cuando hace los cambios. 

> Una aplicación Shiny tiene que comenzar con la carga de la librería Shiny (library(shiny)) y terminar con 
> la llamada a shinyApp, de esta forma ud.
> Recuerde que su session `R` estará ocupada mientras la aplicación Shiny esté corriendo, por lo que no podrá
> ejecutar comando `R` mientras esta dure. R en este periodo esta monitoriando la app y ejecutando las reacciones
> a los inputs del usuario.
> Para recuperar la session de `R`, aprete la tecla 'Esc' o haga click en el boton **Stop** (se encuentra en la 
> esquina superior izquierda del panel de la consola RStudio).

```
library(shiny)

ui <- ... ## Definiciones d ela interfase de Usuario

server <- ... ## Que es lo que hace la plicacion

shinyApp(ui = ui, server = server) ## La ejecución de la Aplicación Shiny.

```

## Ejecutando ShinyApp

Todas las aplicacion Shiny tienen la misma estructura: un arhivo **app.R** que contiene la ui y el servidor. Ud. puede crear un aplicaicon Shiny haciendo un nuevo directorio y guardando un archivo app.R adentro. Es recomendao que cada aplicacion este siempre en su directorio propio. 

Para ejecutar la aplicación, utilice la fución *runApp* pasando el nombre del directorio donde esta contenido el archivo app.R, si el directorio se llama mi_aplicacion, entonces el código para ejecutarlo sería: 

```
library(shiny)
runApp("my_app")
```

Fijese que esto es muy similar alas funciones *read.csv*, *read.table* y muchas otras en `R`. El primer argumento de la función runApp el el path al archivo desde el directorio de trabajo de la aplicación. El código asume que el directorio de la palicacion está en tu directorio de trabajo (generalmente seteado con la funcion *setwd*). En este caso, el path es solo el nombre del directorio.

## Su Turno

Create a new directory named App-1 in your working directory. Then copy and paste the app.R script above into your directory (the scripts from Hello Shiny). When you are finished the directory should look like this:

Example folder

Launch your app by running runApp("App-1"). Then click escape and make some changes to your app:

Change the title from “Hello Shiny!” to “Hello World!”.

Set the minimum value of the slider bar to 5.

Change the histogram border color from "white" to "orange".

When you are ready, launch your app again. Your new app should match the image below. If it doesn’t, or if you want to check your code, press the model answers button to reveal how we did these tasks.

Modified Hello Shiny screenshot

By default, Shiny apps display in “normal” mode, like the app pictured above. Hello Shiny and the other built in examples display in “showcase mode”, a different mode that displays the app.R script alongside the app.

If you would like your app to display in showcase mode, you can run runApp("App-1", display.mode = "showcase").

Model Answers
Relaunching Apps
To relaunch your Shiny app:

Run runApp("App-1"), or

Open the app.R script in your RStudio editor. RStudio will recognize the Shiny script and provide a Run App button (at the top of the editor). Either click this button to launch your app or use the keyboard shortcut: Command+Shift+Enter (Control+Shift+Enter on Windows).

Run app button

RStudio will launch the app in a new window by default, but you can also choose to have the app launch in a dedicated viewer pane, or in your external web browser. Make your selection by clicking the icon next to Run App.

Launch options

Recap
To create your own Shiny app:

Make a directory named myapp/ for your app.

Save your app.R script inside that directory.

Launch the app with runApp or RStudio’s keyboard shortcuts.

Exit the Shiny app by clicking escape.


Go Further
You can create Shiny apps by copying and modifying existing Shiny apps. The Shiny gallery provides some good examples, or use the eleven pre-built Shiny examples listed below.

runExample("01_hello")      # a histogram
runExample("02_text")       # tables and data frames
runExample("03_reactivity") # a reactive expression
runExample("04_mpg")        # global variables
runExample("05_sliders")    # slider bars
runExample("06_tabsets")    # tabbed panels
runExample("07_widgets")    # help text and submit buttons
runExample("08_html")       # Shiny app built from HTML
runExample("09_upload")     # file upload wizard
runExample("10_download")   # file download wizard
runExample("11_timer")      # an automated timer
Each demonstrates a feature of Shiny apps. All Shiny example apps open in “showcase” mode (with the app.R script in the display).

But why limit yourself to copying other apps? The next few lessons will show you how to build your own Shiny apps from scratch. You’ll learn about each part of a Shiny app, and finish by deploying your own Shiny app online.

When you are ready, continue to Lesson 2, where you will learn how to build the layout and appearance of your Shiny apps.


